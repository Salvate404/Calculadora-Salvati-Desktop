<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Produtos</title>
    <link rel="icon" type="image/png" href="imgfavicon.png">
    <link rel="stylesheet" href="carrinho.css">
    <style>

        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333;
            background-image: url(imgsalvati.png);
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            overflow: hidden;
            position: relative;
            opacity: 0;
            transform: scale(5.00);
            animation: fadeZoomIn 1.0s ease-out forwards;
        }

        @keyframes fadeZoomIn {
            from { opacity: 0; transform: scale(1.05); }
            to { opacity: 1; transform: scale(1); }
        }

        body.fade-zoom-out {
            animation: fadeZoomOut 0.5s ease-in forwards;
        }

        @keyframes fadeZoomOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
        
        #page-wrapper {
            display: flex;
            width: 100%;
            max-width: 1400px;
            gap: 20px;
            position: relative;
        }
        
        .main-layout {
            display: flex;
            width: 100%;
        }

        .container {
            flex: 1;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            box-sizing: border-box;
        }

        .header-title-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            gap: 10px;
            padding-top: 30px;
        }

        .header-title-wrapper img {
            max-height: 100px;
            width: auto;
            margin-bottom: 10px;
        }

        .header-title-wrapper h1 {
            color: #000000;
            font-size: 1.8em;
            margin: 0;
            padding: 0;
            line-height: 1.2;
            display: block;
        }

        /* --- ESTILOS DO CATÁLOGO --- */
        .search-and-buy-mode {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #searchInput {
            flex: 1;
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        #buyModeButton {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #buyModeButton:hover {
            background-color: #218838;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
        }
        
        th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        th:nth-child(1) {
            border-top-left-radius: 10px;
            border-bottom-left-radius: 10px;
        }

        th:nth-child(7) {
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        body.cart-open tr {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        body.cart-open tr:hover {
            background-color: #e9ecef;
        }

        #pagination-container {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .page-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .page-button:hover {
            background-color: #0056b3;
        }

        .page-button.active {
            background-color: #0056b3;
            font-weight: bold;
        }

        /* --- BARRA LATERAL DO CARRINHO --- */
        #shopping-cart-sidebar {
            width: var(--sidebar-width);
            background-color: #ffffff;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            box-sizing: border-box;
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
            height: calc(100vh - 40px);
            display: none;
            flex-direction: column;
        }
        
        body.cart-open #shopping-cart-sidebar {
            display: flex;
        }
        
        #close-cart-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        #shopping-cart-sidebar h2 {
            text-align: center;
        }
        
        .client-info-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .client-info-container label {
            flex-shrink: 0;
        }
        
        .client-info-container input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        
        .client-info-container button {
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #cart-items {
            flex-grow: 1;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .cart-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .cart-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .cart-item-header h4 {
            margin: 0;
            font-size: 1em;
            color: #007bff;
        }
        
        .cart-item-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-item-quantity-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .cart-item-quantity-control button {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            width: 25px;
            height: 25px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .cart-item-quantity {
            font-weight: bold;
        }
        
        .price-options {
            display: flex;
            gap: 15px;
            font-size: 0.8em;
            color: #555;
        }
        
        .price-options label {
            display: flex;
            align-items: center;
            gap: 3px;
            cursor: pointer;
        }
        
        #cart-summary {
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        
        #cart-summary h3 {
            display: flex;
            justify-content: space-between;
            margin: 0;
        }
        
        .cart-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        #clearCartButton, #saveCartButton {
            flex: 1;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #clearCartButton {
            background-color: #dc3545;
        }
        
        #clearCartButton:hover {
            background-color: #c82333;
        }
        
        #saveCartButton {
            background-color: #28a745;
        }
        
        #saveCartButton:hover {
            background-color: #218838;
        }

        #payment-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        #payment-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .payment-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        #payment-method-select {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #payment-amount-input {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #add-payment-btn {
            padding: 8px 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #payment-list {
            list-style: none;
            padding: 0;
            max-height: 80px;
            overflow-y: auto;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            align-items: center;
            font-size: 0.9em;
        }

        .payment-item button {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.8em;
        }

        #payment-summary {
            padding-top: 10px;
            margin-top: 10px;
            border-top: 1px solid #ddd;
            font-weight: bold;
        }
        
        #payment-summary p {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        
        /* --- ESTILOS DOS MODAIS --- */
        #saved-carts-modal,
        #client-data-modal,
        #custom-confirm-modal,
        #password-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            width: 80%;
            max-width: 600px;
            position: relative;
        }
        
        .modal-content h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            text-align: center;
        }

        #saved-carts-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 40vh;
            overflow-y: auto;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        .saved-cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        .saved-cart-item:last-child {
            border-bottom: none;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* --- ESTILOS ESPECÍFICOS DE CADA MODAL --- */
        #saved-carts-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        #deleteAllCartsBtn {
            width: 100%;
            padding: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #deleteAllCartsBtn:hover {
            background-color: #c82333;
        }

        #password-modal #passwordInput {
            width: 100%;
            padding: 10px;
            margin: 20px 0;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        #password-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        #password-modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
        }
        
        #cancelPasswordBtn {
            background-color: #6c757d;
        }

        #cancelPasswordBtn:hover {
            background-color: #5a6268;
        }

        #confirmPasswordBtn {
            background-color: #28a745;
        }

        #confirmPasswordBtn:hover {
            background-color: #218838;
        }

        #client-form-type {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        #client-form-type button {
            padding: 10px 15px;
            background-color: #e9ecef;
            color: #495057;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #client-form-type button.active {
            background-color: #007bff;
            color: white;
        }

        #client-form-container input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .saved-cart-info {
            flex-grow: 1;
            font-size: 0.9em;
        }
        
        .saved-cart-info span {
            display: block;
            color: #6c757d;
        }
        
        .saved-cart-actions {
            display: flex;
            gap: 10px;
        }

        .saved-cart-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            color: white;
        }
        
        .load-btn {
            background-color: #007bff;
        }
        .load-btn:hover {
            background-color: #0056b3;
        }
        
        .delete-btn {
            background-color: #dc3545;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        
        #custom-confirm-modal .modal-content {
            text-align: center;
            max-width: 400px;
        }
        
        #custom-confirm-modal p {
            font-size: 1.1em;
            margin: 20px 0;
        }

        #custom-confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        #custom-confirm-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            color: white;
        }
        
        #confirm-yes-btn {
            background-color: #28a745;
        }
        
        #confirm-yes-btn:hover {
            background-color: #218838;
        }
        
        #confirm-no-btn {
            background-color: #dc3545;
        }
        
        #confirm-no-btn:hover {
            background-color: #c82333;
        }
        
        /* --- ESTILOS DO NOVO SISTEMA DE NOTIFICAÇÕES (TOAST) --- */
        #notifications-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background-color: #fff;
            color: #333;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            min-width: 250px;
            animation: slideInUp 0.5s ease-out forwards, fadeOut 0.5s 4.5s ease-in forwards;
        }
        
        .toast.success {
            border-left: 5px solid #28a745;
        }
        
        .toast.error {
            border-left: 5px solid #dc3545;
        }
        
        .toast-close-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 1.2em;
            cursor: pointer;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* --- OUTROS ESTILOS --- */
        #logoutButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            text-decoration: none;
            display: inline-block;
            z-index: 1001;
        }

        #logoutButton:hover {
            background-color: #c82333;
        }
        
        #savedCartsButton {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #007bff;
            color: #ffffff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            text-decoration: none;
            display: inline-block;
            z-index: 1001;
        }
        
        #savedCartsButton:hover {
            background-color: #0056b3;
        }
        
        #userTypeDisplay {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 0.85em;
            font-weight: normal;
            z-index: 10;
        }

        /* Classe para corrigir a acessibilidade do formulário */
        .hidden-label {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="page-wrapper">
        <div class="main-layout">
            <div class="container">
                <div class="header-title-wrapper">
                    <img src="imglogo.png" alt="Logo da Empresa">
                    <h1>Catálogo de Produtos</h1>
                </div>

                <div class="search-and-buy-mode">
                    <input type="text" id="searchInput" placeholder="Buscar por nome ou código...">
                    <button id="buyModeButton">Modo Compras</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Código</th>
                            <th>Unidade</th>
                            <th>Descrição</th>
                            <th>Preço Atacado</th>
                            <th>Preço Varejo</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        </tbody>
                </table>

                <div id="pagination-container">
                    </div>
            </div>
        </div>
        
        <div id="shopping-cart-sidebar">
            <button id="close-cart-btn">&times;</button>
            <h2>Meu Carrinho</h2>

            <div class="client-info-container">
                <label for="clientNameInput">Cliente:</label>
                <input type="text" id="clientNameInput" placeholder="Nome do cliente">
                <button id="clientDataBtn">Dados</button>
            </div>

            <div id="cart-items">
                </div>
            <div id="cart-summary">
                <h3>Total: <span id="cart-total-price">R$ 0,00</span></h3>
                <div class="cart-buttons">
                    <button id="clearCartButton">Limpar Carrinho</button>
                    <button id="saveCartButton">Guardar Carrinho</button>
                </div>
                
                <div id="payment-section">
                    <h4>Pagamento</h4>
                    <div class="payment-input-group">
                        <label for="payment-method-select">Método de Pagamento</label>
                        <select id="payment-method-select" aria-label="Método de Pagamento">
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Pix">Pix</option>
                            <option value="Crédito">Crédito</option>
                            <option value="Débito">Débito</option>
                        </select>
                        <input type="number" id="payment-amount-input" placeholder="Valor" min="0" step="0.01">
                        <button id="add-payment-btn">Adicionar</button>
                    </div>
                    
                    <ul id="payment-list">
                        </ul>
                    
                    <div id="payment-summary">
                        <p>Total Pago: <span id="total-paid">R$ 0,00</span></p>
                        <p>Restante: <span id="remaining-balance">R$ 0,00</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="saved-carts-modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSavedCartsModalBtn">&times;</span>
            <h3>Carrinhos Guardados</h3>
            <ul id="saved-carts-list">
                </ul>
            <div id="saved-carts-footer">
                <button id="deleteAllCartsBtn">Excluir Todos os Carrinhos</button>
            </div>
        </div>
    </div>
    
    <div id="client-data-modal">
        <div class="modal-content">
            <span class="close-modal" id="closeClientDataModalBtn">&times;</span>
            <h3>Dados do Cliente</h3>
            
            <div id="client-form-type">
                <button id="fisicaBtn" class="active">Pessoa Física</button>
                <button id="juridicaBtn">Pessoa Jurídica</button>
            </div>

            <div id="client-form-container">
                <div id="fisica-form">
                    <input type="text" id="cpfInput" placeholder="CPF">
                    <input type="text" id="cepFisicaInput" placeholder="CEP">
                    <input type="text" id="estadoFisicaInput" placeholder="Estado">
                    <input type="text" id="cidadeFisicaInput" placeholder="Cidade">
                    <input type="text" id="ruaFisicaInput" placeholder="Rua">
                    <input type="text" id="numeroFisicaInput" placeholder="Número">
                    <input type="text" id="complementoFisicaInput" placeholder="Complemento">
                </div>
                <div id="juridica-form" class="hidden">
                    <input type="text" id="nomeFantasiaInput" placeholder="Nome Fantasia">
                    <input type="text" id="cnpjInput" placeholder="CNPJ">
                    <input type="text" id="inscricaoEstadualInput" placeholder="Inscrição Estadual">
                    <input type="text" id="cepJuridicaInput" placeholder="CEP">
                    <input type="text" id="estadoJuridicaInput" placeholder="Estado">
                    <input type="text" id="cidadeJuridicaInput" placeholder="Cidade">
                    <input type="text" id="ruaJuridicaInput" placeholder="Rua">
                    <input type="text" id="numeroJuridicaInput" placeholder="Número">
                    <input type="text" id="complementoJuridicaInput" placeholder="Complemento">
                </div>
            </div>
        </div>
    </div>
    
    <div id="password-modal">
        <div class="modal-content">
            <span class="close-modal" id="closePasswordModalBtn">&times;</span>
            <h3>Digite a Senha</h3>
            <p>Para excluir todos os carrinhos, por favor, digite a senha.</p>
            <input type="password" id="passwordInput" placeholder="Senha">
            <div id="password-modal-buttons">
                <button id="cancelPasswordBtn">Cancelar</button>
                <button id="confirmPasswordBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="custom-confirm-modal">
        <div class="modal-content">
            <p id="custom-confirm-message"></p>
            <div id="custom-confirm-buttons">
                </div>
        </div>
    </div>

    <div id="notifications-container"></div>

    <a href="#" id="logoutButton" >menu</a>
    <a href="#" id="savedCartsButton">Carrinhos</a>
    <span id="userTypeDisplay"></span>

    <script src="produtos.js"></script>

    <script>
        // Variáveis e elementos do DOM (antes em cart.js e catalogo.html)
        let shoppingCart = [];
        let splitPayments = [];
        let loadedCartId = null;
        let clientData = {
            nomeCliente: '',
            tipo: 'fisica',
            dadosFisica: {},
            dadosJuridica: {}
        };
        
        const itemsPerPage = 30;
        let currentPage = 1;
        let filteredProducts = [];
        
        const productTableBody = document.getElementById('productTableBody');
        const paginationContainer = document.getElementById('pagination-container');
        const searchInput = document.getElementById('searchInput');
        const buyModeButton = document.getElementById('buyModeButton');
        const bodyElement = document.body;
        
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotalPriceElement = document.getElementById('cart-total-price');
        const paymentMethodSelect = document.getElementById('payment-method-select');
        const paymentAmountInput = document.getElementById('payment-amount-input');
        const paymentList = document.getElementById('payment-list');
        const totalPaidSpan = document.getElementById('total-paid');
        const remainingBalanceSpan = document.getElementById('remaining-balance');
        const clientNameInput = document.getElementById('clientNameInput');
        const clientDataModal = document.getElementById('client-data-modal');
        const savedCartsModal = document.getElementById('saved-carts-modal');
        const savedCartsList = document.getElementById('saved-carts-list');
        const customConfirmModal = document.getElementById('custom-confirm-modal');
        const customConfirmMessage = document.getElementById('custom-confirm-message');
        const customConfirmButtons = document.getElementById('custom-confirm-buttons');
        const notificationsContainer = document.getElementById('notifications-container');

        const addPaymentBtn = document.getElementById('add-payment-btn');
        const fisicaBtn = document.getElementById('fisicaBtn');
        const juridicaBtn = document.getElementById('juridicaBtn');
        const fisicaForm = document.getElementById('fisica-form');
        const juridicaForm = document.getElementById('juridica-form');
        const deleteAllCartsBtn = document.getElementById('deleteAllCartsBtn');
        
        // Novos elementos do modal de senha
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('passwordInput');
        const closePasswordModalBtn = document.getElementById('closePasswordModalBtn');
        const cancelPasswordBtn = document.getElementById('cancelPasswordBtn');
        const confirmPasswordBtn = document.getElementById('confirmPasswordBtn');

        const formElements = {
            fisica: {
                cpf: document.getElementById('cpfInput'),
                cep: document.getElementById('cepFisicaInput'),
                estado: document.getElementById('estadoFisicaInput'),
                cidade: document.getElementById('cidadeFisicaInput'),
                rua: document.getElementById('ruaFisicaInput'),
                numero: document.getElementById('numeroFisicaInput'),
                complemento: document.getElementById('complementoFisicaInput'),
            },
            juridica: {
                nomeFantasia: document.getElementById('nomeFantasiaInput'),
                cnpj: document.getElementById('cnpjInput'),
                inscricaoEstadual: document.getElementById('inscricaoEstadualInput'),
                cep: document.getElementById('cepJuridicaInput'),
                estado: document.getElementById('estadoJuridicaInput'),
                cidade: document.getElementById('cidadeJuridicaInput'),
                rua: document.getElementById('ruaJuridicaInput'),
                numero: document.getElementById('numeroJuridicaInput'),
                complemento: document.getElementById('complementoJuridicaInput'),
            }
        };

        // Funções do carrinho e da interface
        function addItemToCart(productId) {
            const product = catalogoProdutos.find(p => p.id === productId);
            let cartItem = shoppingCart.find(item => item.id === productId);
            if (product) {
                if (cartItem) {
                    cartItem.quantity++;
                } else {
                    shoppingCart.push({ ...product, quantity: 1, priceType: 'varejo' });
                }
                renderCart();
            }
        }
        
        function renderCart() {
            cartItemsContainer.innerHTML = '';
            const cartTotal = getCartTotal();

            if (shoppingCart.length === 0) {
                cartItemsContainer.innerHTML = '<p style="text-align: center; color: #6c757d;">O carrinho está vazio.</p>';
            } else {
                shoppingCart.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('cart-item');
                    
                    const price = item.priceType === 'atacado' ? item.precoAtacado : item.precoVarejo;
                    const precoTotalItem = (price * item.quantity).toFixed(2);
                    
                    itemDiv.innerHTML = `
                        <div class="cart-item-header">
                            <h4>${item.nome}</h4>
                            <div class="cart-item-quantity-control">
                                <button data-action="change-quantity" data-id="${item.id}" data-delta="-1">-</button>
                                <span class="cart-item-quantity">${item.quantity}</span>
                                <button data-action="change-quantity" data-id="${item.id}" data-delta="1">+</button>
                            </div>
                        </div>
                        <div class="cart-item-details">
                            <div class="price-options">
                                <label>
                                    <input type="radio" name="price-${item.id}" data-action="change-price" data-id="${item.id}" value="atacado" ${item.priceType === 'atacado' ? 'checked' : ''}>
                                    Atacado
                                </label>
                                <label>
                                    <input type="radio" name="price-${item.id}" data-action="change-price" data-id="${item.id}" value="varejo" ${item.priceType === 'varejo' ? 'checked' : ''}>
                                    Varejo
                                </label>
                            </div>
                            <span>Total: R$ ${precoTotalItem}</span>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemDiv);
                });
            }
            cartTotalPriceElement.innerText = `R$ ${cartTotal.toFixed(2)}`;
            renderPayments();
        }

        function changeQuantity(productId, delta) {
            const cartItem = shoppingCart.find(item => item.id === productId);
            if (cartItem) {
                const newQuantity = cartItem.quantity + delta;
                if (newQuantity <= 0) {
                    shoppingCart = shoppingCart.filter(item => item.id !== productId);
                } else {
                    cartItem.quantity = newQuantity;
                }
                renderCart();
            }
        }

        function changePriceType(productId, type) {
            const cartItem = shoppingCart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.priceType = type;
                renderCart();
            }
        }

        function clearCart() {
            showConfirmModal('Tem certeza que deseja limpar o carrinho atual?', (confirmed) => {
                if (confirmed) {
                    shoppingCart = [];
                    splitPayments = [];
                    clientNameInput.value = '';
                    clientData = {
                        nomeCliente: '',
                        tipo: 'fisica',
                        dadosFisica: {},
                        dadosJuridica: {}
                    };
                    loadedCartId = null;
                    document.getElementById('saveCartButton').innerText = 'Guardar Carrinho';
                    renderCart();
                    showToast('Carrinho limpo com sucesso!', 'success');
                }
            });
        }

        function saveCart() {
            if (shoppingCart.length === 0) {
                showToast('O carrinho está vazio e não pode ser guardado.', 'error');
                return;
            }

            const savedCarts = JSON.parse(localStorage.getItem('savedCarts')) || [];
            clientData.nomeCliente = clientNameInput.value;
            clientData.dadosFisica = getFormData('fisica');
            clientData.dadosJuridica = getFormData('juridica');

            if (loadedCartId) {
                // Atualizar carrinho existente
                const cartIndex = savedCarts.findIndex(cart => cart.id === loadedCartId);
                if (cartIndex > -1) {
                    savedCarts[cartIndex] = {
                        id: loadedCartId,
                        items: shoppingCart,
                        payments: splitPayments,
                        client: clientData,
                        date: new Date().toLocaleString() // Atualiza a data
                    };
                    localStorage.setItem('savedCarts', JSON.stringify(savedCarts));
                    showToast('Carrinho atualizado com sucesso!', 'success');
                } else {
                    showToast('Erro: Carrinho carregado não encontrado para atualização.', 'error');
                    loadedCartId = null; // Reseta o ID se não encontrar
                    saveCart(); // Tenta salvar como um novo carrinho
                }
            } else {
                // Guardar novo carrinho
                const savedCarts = JSON.parse(localStorage.getItem('savedCarts')) || [];
                const cartId = Date.now();
                
                clientData.nomeCliente = clientNameInput.value;
                clientData.dadosFisica = getFormData('fisica');
                clientData.dadosJuridica = getFormData('juridica');

                savedCarts.unshift({ 
                    id: cartId, 
                    items: shoppingCart, 
                    payments: splitPayments, 
                    client: clientData,
                    date: new Date().toLocaleString() 
                });
                localStorage.setItem('savedCarts', JSON.stringify(savedCarts));
                showToast('Carrinho guardado com sucesso!', 'success');
            }
        }

        function showSavedCartsModal() {
            renderSavedCartsModal();
            savedCartsModal.style.display = 'flex';
        }

        function hideSavedCartsModal() {
            savedCartsModal.style.display = 'none';
        }

        function closeCart() {
            document.body.classList.remove('cart-open');
        }

        function showClientDataModal() {
            if (clientData.tipo === 'fisica') {
                showFisicaForm();
                setFormData('fisica', clientData.dadosFisica);
            } else {
                showJuridicaForm();
                setFormData('juridica', clientData.dadosJuridica);
            }
            clientDataModal.style.display = 'flex';
        }

        function hideClientDataModal() {
            if (fisicaForm.style.display !== 'none') {
                clientData.dadosFisica = getFormData('fisica');
                clientData.tipo = 'fisica';
            } else {
                clientData.dadosJuridica = getFormData('juridica');
                clientData.tipo = 'juridica';
            }
            clientDataModal.style.display = 'none';
        }

        function getCartTotal() {
            return shoppingCart.reduce((total, item) => {
                const price = item.priceType === 'atacado' ? item.precoAtacado : item.precoVarejo;
                return total + price * item.quantity;
            }, 0);
        }

        function renderPayments() {
            const cartTotal = getCartTotal();
            paymentList.innerHTML = '';
            let totalPaid = 0;

            if (splitPayments.length > 0) {
                splitPayments.forEach((payment, index) => {
                    totalPaid += payment.amount;
                    const paymentItem = document.createElement('li');
                    paymentItem.classList.add('payment-item');
                    paymentItem.innerHTML = `
                        <span>${payment.method}: R$ ${payment.amount.toFixed(2)}</span>
                        <button data-action="remove-payment" data-index="${index}">&times;</button>
                    `;
                    paymentList.appendChild(paymentItem);
                });
            }

            totalPaidSpan.innerText = `R$ ${totalPaid.toFixed(2)}`;
            const remaining = cartTotal - totalPaid;
            remainingBalanceSpan.innerText = `R$ ${remaining.toFixed(2)}`;
            remainingBalanceSpan.style.color = remaining < 0 ? 'red' : '#333';
        }

        function addPayment() {
            const method = paymentMethodSelect.value;
            const amount = parseFloat(paymentAmountInput.value);
            const cartTotal = getCartTotal();
            const totalPaid = splitPayments.reduce((sum, p) => sum + p.amount, 0);

            if (isNaN(amount) || amount <= 0) {
                showToast('Por favor, insira um valor válido.', 'error');
                return;
            }

            if (totalPaid + amount > cartTotal) {
                showToast('O valor adicionado ultrapassa o total do carrinho.', 'error');
                return;
            }

            splitPayments.push({ method: method, amount: amount });
            paymentAmountInput.value = '';
            renderPayments();
        }

        function removePayment(index) {
            splitPayments.splice(index, 1);
            renderPayments();
        }

        function showToast(message, type = 'success', duration = 5000) {
            const toast = document.createElement('div');
            toast.classList.add('toast', type);
            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-close-btn">&times;</button>
            `;
            
            notificationsContainer.appendChild(toast);
            
            const closeBtn = toast.querySelector('.toast-close-btn');
            closeBtn.addEventListener('click', () => {
                toast.remove();
            });
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duration);
        }

        function showConfirmModal(message, callback) {
            customConfirmMessage.innerText = message;
            customConfirmButtons.innerHTML = `
                <button id="confirm-no-btn">Não</button>
                <button id="confirm-yes-btn">Sim</button>
            `;
            
            customConfirmModal.style.display = 'flex';
            
            document.getElementById('confirm-yes-btn').onclick = () => {
                customConfirmModal.style.display = 'none';
                callback(true);
            };
            
            document.getElementById('confirm-no-btn').onclick = () => {
                customConfirmModal.style.display = 'none';
                callback(false);
            };
        }

        function renderSavedCartsModal() {
            savedCartsList.innerHTML = '';
            const savedCarts = JSON.parse(localStorage.getItem('savedCarts')) || [];
            
            if (savedCarts.length === 0) {
                savedCartsList.innerHTML = '<li style="text-align: center; color: #6c757d;">Nenhum carrinho guardado.</li>';
            } else {
                savedCarts.forEach(cart => {
                    const cartItem = document.createElement('li');
                    cartItem.classList.add('saved-cart-item');
                    
                    const clientName = (cart.client && cart.client.nomeCliente) ? cart.client.nomeCliente : 'Desconhecido';

                    cartItem.innerHTML = `
                        <div class="saved-cart-info">
                            <strong>${clientName}</strong>
                            <span>Guardado em: ${cart.date}</span>
                        </div>
                        <div class="saved-cart-actions">
                            <button class="load-btn" data-action="load-cart" data-id="${cart.id}">Carregar</button>
                        </div>
                    `;
                    savedCartsList.appendChild(cartItem);
                });
            }
        }


        function loadCart(cartId) {
            const savedCarts = JSON.parse(localStorage.getItem('savedCarts')) || [];
            const cartToLoad = savedCarts.find(cart => cart.id === cartId);
            
            if (cartToLoad) {
                shoppingCart = cartToLoad.items;
                splitPayments = cartToLoad.payments || [];
                clientData = cartToLoad.client || { nomeCliente: '', tipo: 'fisica', dadosFisica: {}, dadosJuridica: {} };
                clientNameInput.value = clientData.nomeCliente;

                loadedCartId = cartId;
                document.getElementById('saveCartButton').innerText = 'Atualizar Carrinho';
                
                renderCart();
                hideSavedCartsModal();
                document.body.classList.add('cart-open');
                showToast('Carrinho carregado com sucesso!', 'success');
            } else {
                showToast('Erro ao carregar o carrinho.', 'error');
            }
        }

        function deleteCart(cartId) {
            const savedCarts = JSON.parse(localStorage.getItem('savedCarts')) || [];
            const cartToDelete = savedCarts.find(cart => cart.id === cartId);
            if (!cartToDelete) return;

            const clientName = (cartToDelete.client && cartToDelete.client.nomeCliente) || 'Cliente Desconhecido';

            showConfirmModal(`Tem certeza que deseja excluir o carrinho de "${clientName}"?`, (confirmed) => {
                if (confirmed) {
                    const updatedCarts = savedCarts.filter(cart => cart.id !== cartId);
                    localStorage.setItem('savedCarts', JSON.stringify(updatedCarts));
                    renderSavedCartsModal();
                    showToast('Carrinho excluído com sucesso!', 'success');
                }
            });
        }

        function deleteCart(cartId) {
            const savedCarts = JSON.parse(localStorage.getItem('savedCarts')) || [];
            const cartToDelete = savedCarts.find(cart => cart.id === cartId);
            if (!cartToDelete) return;

            const clientName = (cartToDelete.client && cartToDelete.client.nomeCliente) || 'Cliente Desconhecido';
        }

        function showPasswordModal() {
            passwordModal.style.display = 'flex';
            passwordInput.focus();
        }

        function deleteAllSavedCarts() {
            showPasswordModal();

            // Lógica para o modal de senha
            const handleConfirm = () => {
                const password = passwordInput.value;
                const correctPassword = "2217211908As";
                
                if (password === correctPassword) {
                    showConfirmModal('Tem certeza que deseja excluir TODOS os carrinhos? Esta ação é irreversível.', (confirmed) => {
                        if (confirmed) {
                            localStorage.removeItem('savedCarts');
                            renderSavedCartsModal();
                            showToast('Todos os carrinhos foram excluídos com sucesso!', 'success');
                        }
                        passwordModal.style.display = 'none';
                        passwordInput.value = '';
                    });
                } else {
                    showToast('Senha incorreta. Ação cancelada.', 'error');
                    passwordModal.style.display = 'none';
                    passwordInput.value = '';
                }
            };
            
            const handleCancel = () => {
                passwordModal.style.display = 'none';
                passwordInput.value = '';
                showToast('Exclusão de carrinhos cancelada.', 'error');
            };

            confirmPasswordBtn.onclick = handleConfirm;
            cancelPasswordBtn.onclick = handleCancel;
            closePasswordModalBtn.onclick = handleCancel;
        }

        function showFisicaForm() {
            if (fisicaForm) {
                fisicaForm.classList.remove('hidden');
                juridicaForm.classList.add('hidden');
                fisicaBtn.classList.add('active');
                juridicaBtn.classList.remove('active');
            }
        }

        function showJuridicaForm() {
            if (juridicaForm) {
                fisicaForm.classList.add('hidden');
                juridicaForm.classList.remove('hidden');
                juridicaBtn.classList.add('active');
                fisicaBtn.classList.remove('active');
            }
        }

        function getFormData(type) {
            const formData = {};
            const elements = formElements[type];
            for (const key in elements) {
                if (elements[key]) {
                    formData[key] = elements[key].value;
                }
            }
            return formData;
        }

        function setFormData(type, data) {
            const elements = formElements[type];
            for (const key in elements) {
                if (elements[key]) {
                    elements[key].value = data[key] || '';
                }
            }
        }

        // Funções de paginação e pesquisa do catálogo
        function addExitAnimationAndRedirect() {
            document.body.classList.add('fade-zoom-out');
            setTimeout(() => {
                localStorage.removeItem('tipoUsuario');
                localStorage.removeItem('usuarioLogado');
                localStorage.removeItem('tempoLogin');
                window.location.href = 'menu.html';
            }, 500);
        }
        
        function displayProducts(products, page) {
            productTableBody.innerHTML = '';
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = products.slice(startIndex, endIndex);

            if (paginatedItems.length === 0) {
                productTableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Nenhum produto encontrado.</td></tr>';
                return;
            }

            paginatedItems.forEach(product => {
                const row = document.createElement('tr');
                row.dataset.id = product.id;
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.nome}</td>
                    <td>${product.codigo}</td>
                    <td>${product.unidade}</td>
                    <td>${product.descricao}</td>
                    <td>R$ ${product.precoAtacado.toFixed(2)}</td>
                    <td>R$ ${product.precoVarejo.toFixed(2)}</td>
                `;
                productTableBody.appendChild(row);
            });
        }
        
        function setupPagination(products) {
            paginationContainer.innerHTML = '';
            const pageCount = Math.ceil(products.length / itemsPerPage);
            for (let i = 1; i <= pageCount; i++) {
                const btn = document.createElement('button');
                btn.classList.add('page-button');
                btn.innerText = i;
                if (i === currentPage) {
                    btn.classList.add('active');
                }
                btn.addEventListener('click', () => {
                    currentPage = i;
                    displayProducts(products, currentPage);
                    const currentActiveBtn = document.querySelector('.page-button.active');
                    if (currentActiveBtn) {
                        currentActiveBtn.classList.remove('active');
                    }
                    btn.classList.add('active');
                });
                paginationContainer.appendChild(btn);
            }
        }
        
        function searchProducts() {
            const searchTerm = searchInput.value.toLowerCase();
            filteredProducts = catalogoProdutos.filter(product => 
                product.nome.toLowerCase().includes(searchTerm) || 
                product.codigo.toLowerCase().includes(searchTerm)
            );
            currentPage = 1;
            setupPagination(filteredProducts);
            displayProducts(filteredProducts, currentPage);
        }

        // Adição dos listeners de eventos
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof catalogoProdutos !== 'undefined' && Array.isArray(catalogoProdutos)) {
                filteredProducts = catalogoProdutos;
                setupPagination(filteredProducts);
                displayProducts(filteredProducts, currentPage);
            } else {
                productTableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Erro: O catálogo de produtos não foi carregado corretamente. Por favor, verifique se o arquivo produtos.js existe e está na mesma pasta.</td></tr>';
            }
        });

        buyModeButton.addEventListener('click', () => {
            bodyElement.classList.toggle('cart-open');
            renderCart();
        });

        document.getElementById('logoutButton').addEventListener('click', addExitAnimationAndRedirect);
        document.getElementById('close-cart-btn').addEventListener('click', closeCart);
        document.getElementById('clearCartButton').addEventListener('click', clearCart);
        document.getElementById('saveCartButton').addEventListener('click', saveCart);
        document.getElementById('savedCartsButton').addEventListener('click', showSavedCartsModal);
        document.getElementById('clientDataBtn').addEventListener('click', showClientDataModal);
        document.getElementById('closeSavedCartsModalBtn').addEventListener('click', hideSavedCartsModal);
        document.getElementById('closeClientDataModalBtn').addEventListener('click', hideClientDataModal);
        
        productTableBody.addEventListener('click', (event) => {
            if (bodyElement.classList.contains('cart-open')) {
                const row = event.target.closest('tr');
                if (row) {
                    const productId = row.dataset.id;
                    addItemToCart(productId);
                }
            }
        });
        
        searchInput.addEventListener('keyup', searchProducts);

        if (cartItemsContainer) {
            cartItemsContainer.addEventListener('click', (event) => {
                const target = event.target;
                const action = target.dataset.action;
                const id = target.dataset.id;
                const delta = parseInt(target.dataset.delta);
                const priceType = target.value;
                
                if (action === 'change-quantity') {
                    changeQuantity(id, delta);
                } else if (action === 'change-price') {
                    changePriceType(id, priceType);
                }
            });
        }

        if (paymentList) {
            paymentList.addEventListener('click', (event) => {
                const target = event.target;
                if (target.dataset.action === 'remove-payment') {
                    const index = parseInt(target.dataset.index);
                    removePayment(index);
                }
            });
        }

        if (savedCartsList) {
            savedCartsList.addEventListener('click', (event) => {
                const target = event.target.closest('button');
                if (!target) return;

                const action = target.dataset.action;
                const id = parseInt(target.dataset.id);
                
                if (action === 'load-cart') {
                    loadCart(id);
                } else if (action === 'delete-cart') {
                    deleteCart(id);
                }
            });
        }
        
        if (deleteAllCartsBtn) {
            deleteAllCartsBtn.addEventListener('click', deleteAllSavedCarts);
        }

        if (fisicaBtn) {
            fisicaBtn.addEventListener('click', showFisicaForm);
        }
        if (juridicaBtn) {
            juridicaBtn.addEventListener('click', showJuridicaForm);
        }
        if (addPaymentBtn) {
            addPaymentBtn.addEventListener('click', addPayment);
        }
    </script>
</body>
</html>
